
const MR_TABLE = {
  male: {
    0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0,
    7: 0.72, 8: 0.72, 9: 0.75, 10: 0.77, 11: 0.85,
    12: 0.96, 13: 1.02, 14: 1.08, 15: 1.13, 16: 1.17,
    17: 1.22, 18: 1.26, 19: 1.29, 20: 1.33, 21: 1.35,
    22: 1.38, 23: 1.4, 24: 1.42, 25: 1.43, 26: 1.45,
    27: 1.45, 28: 1.46, 29: 1.46, 30: 1.46, 31: 1.49,
    32: 1.53, 33: 1.59, 34: 1.66, 35: 1.75, 36: 1.86,
    37: 1.98, 38: 2.12, 39: 2.3, 40: 2.48, 41: 2.65,
    42: 2.82, 43: 3.04, 44: 3.31, 45: 3.62, 46: 3.98,
    47: 4.39, 48: 4.85, 49: 5.35, 50: 5.91, 51: 6.51,
    52: 7.15, 53: 7.85, 54: 8.6, 55: 9.39, 56: 10.23,
    57: 10.93, 58: 11.83, 59: 12.93, 60: 14.21, 61: 15.69,
    62: 17.37, 63: 19.25, 64: 21.32, 65: 22.42, 66: 25.3,
    67: 28.51, 68: 32.09, 69: 36.08, 70: 40.51, 71: 45.44,
    72: 50.92, 73: 57, 74: 63.75, 75: 71.25, 76: 79.58,
    77: 88.81, 78: 99.06, 79: 110.44, 80: 123.07, 81: 137.1,
    82: 152.68, 83: 168.04, 84: 182.77, 85: 198.73, 86: 216.02,
    87: 234.76, 88: 255.06, 89: 277.03, 90: 300.83, 91: 326.58,
    92: 354.45, 93: 384.6, 94: 417.21, 95: 452.46, 96: 490.56,
    97: 531.72, 98: 576.18, 99: 623.3
  },
  female: {
    0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0,
    7: 0.72, 8: 0.72, 9: 0.72, 10: 0.72, 11: 0.75,
    12: 0.77, 13: 0.85, 14: 0.96, 15: 1.02, 16: 1.08,
    17: 1.13, 18: 1.17, 19: 1.22, 20: 1.26, 21: 1.29,
    22: 1.33, 23: 1.35, 24: 1.38, 25: 1.4, 26: 1.42,
    27: 1.43, 28: 1.45, 29: 1.45, 30: 1.46, 31: 1.46,
    32: 1.46, 33: 1.49, 34: 1.53, 35: 1.59, 36: 1.66,
    37: 1.75, 38: 1.86, 39: 1.98, 40: 2.12, 41: 2.3,
    42: 2.48, 43: 2.65, 44: 2.82, 45: 3.04, 46: 3.31,
    47: 3.62, 48: 3.98, 49: 4.39, 50: 4.85, 51: 5.35,
    52: 5.91, 53: 6.51, 54: 7.15, 55: 7.85, 56: 8.6,
    57: 9.39, 58: 10.23, 59: 10.93, 60: 11.83, 61: 12.93,
    62: 14.21, 63: 15.69, 64: 17.37, 65: 19.25, 66: 22.42,
    67: 25.3, 68: 28.51, 69: 32.09, 70: 36.08, 71: 40.51,
    72: 45.44, 73: 50.92, 74: 57, 75: 63.75, 76: 71.25,
    77: 79.58, 78: 88.81, 79: 99.06, 80: 110.44, 81: 123.07,
    82: 137.1, 83: 152.68, 84: 168.04, 85: 182.77, 86: 198.73,
    87: 216.02, 88: 234.76, 89: 255.06, 90: 277.03, 91: 300.83,
    92: 326.58, 93: 354.45, 94: 384.6, 95: 417.21, 96: 452.46,
    97: 490.56, 98: 531.72, 99: 576.18
  }
};

function getMR(age: number, gender: "male" | "female"): number {
  if (age < 0) age = 0;
  if (age > 99) age = 99;
  return MR_TABLE[gender][age] || 1.46;
}

export function calculatePremiums(age: number, gender: "male" | "female", sumAssured: number, smoker: boolean) {
  const MR = getMR(age, gender);

  // Smoker factor: 0.5 for non-smoker, 1.7 for smoker
  const smokerFactor = smoker ? 1.7 : 0.5;

  // Adjusted MR with smoker factor
  const adjustedMR = MR * smokerFactor;

  // Formulas per insurer with adjustedMR
  const icici = ((sumAssured / 1000) * adjustedMR * 0.0827 + 300) * 1.18;
  const hdfc = ((sumAssured / 1000) * adjustedMR * 0.0896 + 300) * 1.18;
  const maxLife = ((sumAssured / 1000) * adjustedMR * 0.0786 + 300) * 1.18;
  const lic = ((sumAssured / 1000) * adjustedMR * 0.06 + 400) * 1.18;
  const sbi = ((sumAssured / 1000) * adjustedMR * 0.08 + 300) * 1.18;

  return {
    "ICICI Prudential": {
      annual: parseFloat(icici.toFixed(2)),
      monthly: parseFloat(((icici / 12) * 1.03).toFixed(2))
    },
    "HDFC Life": {
      annual: parseFloat(hdfc.toFixed(2)),
      monthly: parseFloat(((hdfc / 12) * 1.03).toFixed(2))
    },
    "Max Life": {
      annual: parseFloat(maxLife.toFixed(2)),
      monthly: parseFloat(((maxLife / 12) * 1.03).toFixed(2))
    },
    "LIC": {
      annual: parseFloat(lic.toFixed(2)),
      monthly: parseFloat(((lic / 12) * 1.03).toFixed(2))
    },
    "SBI Life": {
      annual: parseFloat(sbi.toFixed(2)),
      monthly: parseFloat(((sbi / 12) * 1.03).toFixed(2))
    }
  };
}
